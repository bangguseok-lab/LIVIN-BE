<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.livin.property.mapper.FavChecklistMapper">

    <!-- ✅ 사용자의 체크리스트 목록 조회 -->
    <select id="selectFavChecklistsByUserId" resultType="org.livin.property.entity.FavChecklistVO">
        SELECT
            checklist_id,
            user_id,
            title
        FROM
            Checklist
        WHERE
            user_id = #{userId}
          AND
            title NOT REGEXP '\\([0-9]+\\)$'
        ORDER BY
            created_at DESC
    </select>

    <!-- ✅ 체크리스트 항목 매핑 -->
    <resultMap id="favChecklistItemResultMap" type="org.livin.property.entity.FavChecklistItemVO">
        <id property="checklistItemId" column="checklistItem_id"/>
        <result property="checklistId" column="checklist_id"/>
        <result property="keyword" column="keyword"/>
        <result property="active" column="is_active"/>
        <result property="type"
                column="type"
                javaType="org.livin.checklist.entity.checklist_enum.ChecklistItemType"
                typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
    </resultMap>

    <!-- ✅ 체크리스트 ID로 항목 조회 -->
    <select id="selectFavChecklistItemsByChecklistId" resultMap="favChecklistItemResultMap">
        SELECT
            checklistItem_id,
            checklist_id,
            keyword,
            is_active,
            type
        FROM
            ChecklistItem
        WHERE
            checklist_id = #{checklistId}
          AND
            is_active = TRUE
        ORDER BY
            type, keyword
    </select>

</mapper>
